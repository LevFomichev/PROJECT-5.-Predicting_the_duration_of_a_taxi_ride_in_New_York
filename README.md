![image](https://publish.purewow.net/wp-content/uploads/sites/2/2018/05/nyc-yellow-taxi-in-times-square-hero.jpg)

# PROJECT-5. Прогнозирование продолжительности поездки на такси в Нью-Йорке
##  Практика в выполнении задач машинного обучения, направленную на автоматизацию бизнес-процессов.

### Описание проекта

Нам предстоит решить задачу машинного обучения, направленную на автоматизацию бизнес процессов. Мы построим модель, которая будет предсказывать общую продолжительность поездки такси в Нью-Йорке. 

Представим, что мы заказываем такси из одной точки Нью-Йорка в другую, причём необязательно, что конечная точка должна находиться в пределах города. Сколько мы должны будем заплатить за поездку?

Известно, что стоимость такси в США рассчитывается на основе фиксированной ставки и тарифной стоимости, величина которой зависит от времени и расстояния. Тарифы варьируются в зависимости от города.

В свою очередь, время поездки зависит от множества факторов, таких как направление поездки, время суток, погодные условия и так далее.

Таким образом, если мы разработаем алгоритм, способный определять длительность поездки, мы сможем прогнозировать её стоимость самым тривиальным образом, например, просто умножая стоимость на заданный тариф.

Сервисы такси хранят огромные объёмы информации о поездках, включая такие данные, как конечная и начальная точки маршрута, дата поездки и её продолжительность. Эти данные можно использовать для того, чтобы прогнозировать длительность поездки в автоматическом режиме с привлечением искусственного интеллекта.

---

### Бизнес-задача:

Определить характеристики и с их помощью спрогнозировать длительность поездки на такси.

### Техническая задача для специалиста в Data Science:

Построить модель машинного обучения, которая на основе предложенных характеристик клиента будет предсказывать числовой признак — время поездки такси, то есть решить задачу регрессии.

---

### Организационная информация

Проект будет состоять из пяти частей:

1. **Первичная обработка данных**

   В рамках этой части нам предстоит сформировать набор данных на основе предложенных нам источников информации, а также обработать пропуски и выбросы в данных.

2. **Разведывательный анализ данных (EDA)**

   Нам необходимо будет исследовать данные, 'нащупать' первые закономерности и выдвинуть гипотезы.

3. **Отбор и преобразование признаков**

   На этом этапе мы перекодируем и преобразуем данные таким образом, чтобы их можно было использовать при решении задачи регрессии — для построения модели.

4.  **Решение задачи регрессии: линейная регрессия и деревья решений**

    На данном этапе мы построим свои первые прогностические модели и оценим их качество. Тем самым мы создадим так называемый *baseline*, который поможет нам ответить на вопрос: «Решаема ли вообще представленная задача?»

5.  **Решение задачи регрессии: ансамбли моделей и построение прогноза**

     На заключительном этапе мы сможем доработать своё предсказание с использованием более сложных алгоритмов и оценить, с помощью какой модели возможно сделать более качественные прогнозы.

---

### Инструменты

Python:

  * Библиотеки `numpy` и `pandas` — чтение и работа с данными.
  
  * Библиотеки `matplotlib` и `seaborn` — визуализация данных.
  
  * Библиотека `sklearn`:

    * Отбор и преобразование признаков;
    
    * Выборки данных;
    
    * Модели ML и их обучение;

    * Метрики.

---

### Наборы данных

#### Тренировочный и тестовый набор данных

`train` — это тренировочная часть, которую мы будем использовать для обучения и валидации моделей, скачать его можно [здесь](https://drive.google.com/file/d/1lm-WYVSzOLY2wXKNAK_m4TnCvCqheeuU/view?usp=drive_link).

В нём находятся данные о почти 1.5 миллионах поездок и 11 характеристиках, которые описывают каждую из поездок. Условно, признаки можно разделить на несколько групп:

**Данные о клиенте и таксопарке**:

* `id` — уникальный идентификатор поездки;

* `vendor_id` — уникальный идентификатор поставщика услуг (таксопарка), связанного с записью поездки.

**Временные характеристики**:

* `pickup_datetime` — дата и время, когда был включён счётчик поездки;

* `dropoff_datetime` — дата и время, когда счётчик был отключён.

**Географическая информация**:

* `pickup_longitude` — долгота, на которой был включён счётчик;

* `pickup_latitude` — широта, на которой был включён счётчик;

* `dropoff_longitude` — долгота, на которой счётчик был отключён;

* `dropoff_latitude` — широта, на которой счётчик был отключён.

**Прочие признаки**:

* `passenger_count` — количество пассажиров в транспортном средстве (введённое водителем значение);

* `store_and_fwd_flag` — флаг, который указывает, сохранилась ли запись о поездке в памяти транспортного средства перед отправкой поставщику (`Y` — хранить и пересылать, `N` — не хранить и не пересылать поездку).

**Целевой признак:**

* `trip_duration` — продолжительность поездки в секундах.

Пример вывода первых строк нашего тренировочного датасета:

![image](https://lms.skillfactory.ru/asset-v1:SkillFactory+DST-3.0+28FEB2021+type@asset+block@dst3-pr5_2_1.png)

`test` — файл с тестовой выборкой содержит идентичную информарцию о поездках, длительность которых нам и надо будет предсказать. Найти его можно [здесь](https://drive.google.com/file/d/1QTAG4uN91t_i9W1njPpzK3D0Mbjwsc4U/view?usp=drive_link)

---

#### Праздничные дни

`holiday_data` — датасет, хранящий информацию о том, является ли день праздничным. Для этого были собрали даты всех праздничных дней в Америке за 2016 год. Данные представлены в табличном формате `CSV` и содержат три столбца:

* `day` — день недели;

* `date` — дата;

* `holiday` — наименование праздника.

Исходный файл с праздничными датами вы можете скачать [здесь](https://drive.google.com/file/d/1PpnWKNeuJLCtj9ZdeZqGFiiPjmmjeuVY/view?usp=drive_link).

В 2016 году в США было 14 праздничных дней, список которых вы можете видеть ниже:

![image](https://lms.skillfactory.ru/asset-v1:SkillFactory+DST-3.0+28FEB2021+type@asset+block@dst3-pr5_2_2.png)

---

#### OSRM API 

В наших данных есть столбцы, содержащие информацию о широте и долготе. Благодаря чему из них можно извлечь очень много полезной информации.

Например, зная широту и долготу начальной и конечной точек маршрута, мы можем воспользоваться **OSRM API** (ресурс позволяющий построить оптимальный кусочно-линейный путь из точки *А* в точку *B*, а также узнать его примерную длительность и длину).

Проблема заключается в том, что, так как в наших данных содержится информация о более чем одном миллионе поездок, подгрузка данных с помощью *API* и их предобработка может занять несколько часов, а при слабом интернет-соединении — и дней. Поэтому выгрузка данных из *OSRM API* была заранее подготовлена для каждой поездки из тренировочной и тестовой выборок нашего набора данных.

Файлы с данными из *OSRM* для поездок из тренировочной таблицы (`osrm_data_train`) вы можете найти [здесь](https://drive.google.com/file/d/1osFDSPhTFF07RmSiBuAjitUqJTB_Ugc1/view?usp=drive_link). Наборы данных представлены в табличном формате `CSV`. Нас будут интересовать только следующие столбцы:

* `id` — идентификатор поездки;

* `total_distance` — кратчайшее дорожное расстояние (в метрах) из точки, в которой был включён счётчик, до точки, в которой счётчик был выключен (согласно *OSRM*);

* `total_travel_time` — наименьшее время поездки (в секундах) из точки, в которой был включён счётчик, до точки, в которой счётчик был выключен (согласно *OSRM*);

* `number_of_steps` — количество дискретных шагов, которые должен выполнить водитель (поворот налево/поворот направо/ехать прямо и т. д.).

![image](https://lms.skillfactory.ru/asset-v1:SkillFactory+DST-3.0+28FEB2021+type@asset+block@dst3-pr5_2_3.png)

Файлы с данными из *OSRM* для поездок из тестового набора данных (`osrm_data_test`) вы можете найти [здесь](https://drive.google.com/file/d/1205zpK8AZfElyQE0_bD1vffVQE_FvkwX/view?usp=drive_link). Наборы данных представлены в идентичном формате.

---

#### Погодные условия

Другим важным фактором, потенциально влияющим на дорожное движение, является погода. Так, например, логично предположить, что снег и дождь могут затруднять движение и увеличивать время поездки.

[Здесь](https://drive.google.com/file/d/1dRvkEoYVt05VVwAt7_-FxYZic2BFCn6n/view?usp=drive_link) вы можете найти набор данных — `weather_data`, содержащий информацию о погодных условиях в Нью-Йорке в 2016 году. Датасет представлен в табличном формате `CSV`. Нас будут интересовать только следующие столбцы:

* `time` — дата измерения (с интервалом в час);

* `temperature` — температура;

* `visibility` — видимость;

* `wind speed` — средняя скорость ветра;

* `precip` — количество осадков;

* `events` — погодные явления: `Rain` — дождь, `Snow` — снег, `Fog` — туман, `None` — отсутствие погодных явлений.

![image](https://lms.skillfactory.ru/asset-v1:SkillFactory+DST-3.0+28FEB2021+type@asset+block@dst3-pr5_2_6.png)